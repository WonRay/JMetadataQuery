<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AsbtractOperatorSearch.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCo Ant</a> &gt; <a href="index.source.html" class="el_package">aka.jmetadataquery.main.types.search.operation</a> &gt; <span class="el_source">AsbtractOperatorSearch.java</span></div><h1>AsbtractOperatorSearch.java</h1><pre class="source lang-java linenums">package aka.jmetadataquery.main.types.search.operation;

import java.io.File;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.function.Function;
import java.util.stream.Collectors;

import org.eclipse.jdt.annotation.NonNull;
import org.eclipse.jdt.annotation.Nullable;

import aka.jmetadataquery.main.types.search.operation.interfaces.OperatorSearchInterface;

/**
 * Combo condition &quot;AND&quot; of n OperatorSearchInterface.
 *
 * @author charlottew
 */
public abstract class AsbtractOperatorSearch implements OperatorSearchInterface {

<span class="pc" id="L25">    private boolean sameStream = false;</span>
<span class="pc" id="L26">    @NonNull</span>
    private final List&lt;@NonNull OperatorSearchInterface&gt; queries = new ArrayList&lt;&gt;();

    /**
     * Constructor.
     */
<span class="nc" id="L32">    public AsbtractOperatorSearch() {</span>
        // Default constructor.
<span class="nc" id="L34">    }</span>

    /**
     * Constructor.
     *
     * @param sameStream queries must be applied for the same streams ?
     */
<span class="fc" id="L41">    public AsbtractOperatorSearch(final boolean sameStream) {</span>
<span class="fc" id="L42">        this.sameStream = sameStream;</span>
<span class="fc" id="L43">    }</span>

    /**
     * Constructor.
     *
     * @param queries
     * @param sameStream queries must be applied for the same streams ?
     */
<span class="fc" id="L51">    public AsbtractOperatorSearch(final boolean sameStream, @NonNull final OperatorSearchInterface @NonNull... queries) {</span>
<span class="fc bfc" id="L52" title="All 2 branches covered.">        for (final OperatorSearchInterface operatorSearchInterface : queries) {</span>
<span class="fc" id="L53">            this.queries.add(operatorSearchInterface);</span>
        }
<span class="fc" id="L55">        this.sameStream = sameStream;</span>
<span class="fc" id="L56">    }</span>

    /**
     * Add search.
     *
     * @param operatorSearchInterfaces
     */
    public void addSearch(@NonNull final OperatorSearchInterface @NonNull... operatorSearchInterfaces) {
<span class="fc bfc" id="L64" title="All 2 branches covered.">        for (final OperatorSearchInterface operatorSearchInterface : operatorSearchInterfaces) {</span>
<span class="fc" id="L65">            this.queries.add(operatorSearchInterface);</span>
        }
<span class="fc" id="L67">    }</span>

    /**
     * Check for the same stream ?
     *
     * @param sameStream
     */
    public void setSameStream(final boolean sameStream) {
<span class="nc" id="L75">        this.sameStream = sameStream;</span>
<span class="nc" id="L76">    }</span>

    @Override
    public @NonNull Map&lt;@NonNull Integer, Boolean&gt; getStreamsIDInFileMatchingCriteria(@NonNull final File currentFile) {
<span class="nc" id="L80">        return new HashMap&lt;&gt;();</span>
    }

    /**
     * Is the test must be made on the same stream(s) ?
     *
     * @return &lt;code&gt;true&lt;/code&gt; if the test must be made on the same stream(s)
     */
    public boolean checkSameStream() {
<span class="fc" id="L89">        return this.sameStream;</span>
    }

    /**
     * Get list of queries.
     *
     * @return list of queries
     */
    @NonNull
    public List&lt;@NonNull OperatorSearchInterface&gt; getQueries() {
<span class="fc" id="L99">        return this.queries;</span>
    }

    /**
     * Check if both list have same items.
     *
     * @param list1
     * @param list2
     * @return &lt;code&gt;true&lt;/code&gt; if both list have same items.
     */
    public boolean equalLists(@Nullable final List&lt;@NonNull Integer&gt; list1, @Nullable final List&lt;@NonNull Integer&gt; list2) {
<span class="nc" id="L110">        List&lt;@NonNull Integer&gt; one = list1;</span>
<span class="nc" id="L111">        List&lt;@NonNull Integer&gt; two = list2;</span>
<span class="nc bnc" id="L112" title="All 4 branches missed.">        if (one == null &amp;&amp; two == null) {</span>
<span class="nc" id="L113">            return true;</span>
        }

<span class="nc bnc" id="L116" title="All 8 branches missed.">        if ((one == null &amp;&amp; two != null) || (one != null &amp;&amp; two == null)) {</span>
<span class="nc" id="L117">            return false;</span>
        }

        // to avoid messing the order of the lists we will use a copy
        // as noted in comments by A. R. S.
<span class="nc" id="L122">        one = new ArrayList&lt;&gt;(one);</span>
<span class="nc" id="L123">        two = new ArrayList&lt;&gt;(two);</span>

<span class="nc" id="L125">        Collections.sort(one);</span>
<span class="nc" id="L126">        Collections.sort(two);</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (one.size() &gt; two.size()) {</span>
<span class="nc" id="L128">            return one.containsAll(two);</span>
        } else {
<span class="nc" id="L130">            return two.containsAll(one);</span>
        }
    }

    /**
     * Get result list.
     *
     * @param idMapList
     * @param size
     * @return list of result
     */
    @NonNull
    public List&lt;@NonNull Boolean&gt; getResultList(@NonNull final List&lt;@NonNull Map&lt;@NonNull Integer, Boolean&gt;&gt; idMapList, final int size) {
<span class="nc" id="L143">        final List&lt;@NonNull Boolean&gt; result = new ArrayList&lt;&gt;();</span>

        // Check if at least one of Integer (stream Id) is in each map and has same boolean
        // Get list of Integer present in each map
<span class="nc" id="L147">        final List&lt;@NonNull Integer&gt; presentIdList = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">        for (final @NonNull Map&lt;@NonNull Integer, Boolean&gt; map : idMapList) {</span>
<span class="nc" id="L149">            presentIdList.addAll(map.keySet());</span>
<span class="nc" id="L150">        }</span>

<span class="nc" id="L152">        final Map&lt;@NonNull Integer, List&lt;Boolean&gt;&gt; idBooleanListMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L153">        final Map&lt;Integer, Long&gt; idIdCountMap = presentIdList.stream().collect(Collectors.groupingBy(Function.identity(), Collectors.counting()));</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">        for (final Entry&lt;Integer, Long&gt; entry : idIdCountMap.entrySet()) {</span>
<span class="nc" id="L155">            final Long count = entry.getValue();</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">            if (count.intValue() == size) {</span>
                // Check if has same boolean
<span class="nc" id="L158">                final Integer id = entry.getKey();</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">                if (id != null) {</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">                    for (final @NonNull Map&lt;@NonNull Integer, Boolean&gt; entry2 : idMapList) {</span>
<span class="nc" id="L161">                        final Boolean bool = entry2.get(id);</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">                        if (bool != null) {</span>
<span class="nc" id="L163">                            List&lt;Boolean&gt; boolList = idBooleanListMap.get(id);</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">                            if (boolList == null) {</span>
<span class="nc" id="L165">                                boolList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L166">                                idBooleanListMap.put(id, boolList);</span>
                            }
<span class="nc" id="L168">                            boolList.add(bool);</span>
                        }
<span class="nc" id="L170">                    }</span>
                }
            }
<span class="nc" id="L173">        }</span>

        // Check if all bool in list in idBooleanListMap are the same
<span class="nc bnc" id="L176" title="All 2 branches missed.">        for (final Entry&lt;@NonNull Integer, List&lt;Boolean&gt;&gt; entry : idBooleanListMap.entrySet()) {</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">            final boolean allEqual = entry.getValue().stream().distinct().limit(2).count() &lt;= 1;</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">            if (allEqual) {</span>
<span class="nc" id="L179">                final Boolean e = entry.getValue().get(0);</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">                if (e != null) {</span>
<span class="nc" id="L181">                    result.add(e);</span>
                }
            }
<span class="nc" id="L184">        }</span>

<span class="nc" id="L186">        return result;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>